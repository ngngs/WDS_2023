# 클린코드 17일차

## 11장 시스템 (2)

AOP에서 관점(aspect)이라는 모듈 구성 개념은 "특정 관심사를 지원하려면 시스템에서 특정 지점들이 동작하는 방식을 일관성 있게 바꿔야 한다"라고 명시한다.

다음은 자바에서 사용하는 관점 혹은 관점과 유사한 메커니즘 3개이다.

### (1) 자바 프록시
자바 프록시는 단순한 상황에 적합하다. 개별 객체나 클래스에서 메서드 호출을 감싸는 경우 말이다. <br/>
그러나 JDK에서 제공하는 동적 프록시는 인터페이스만 지원한다. 클래스 프록시를 사용하려면 CGLIB, ASM, Javassis 등과 같은 바이트 코드 처리 라이브러리가 필요하다. <br/>
또한 코드가 상당히 많고 복잡하여 clean code를 작성하기엔 좋지 않다.

### (2) 순수 자바 AOP 프레임워크
 
스프링 AOP, JBoss AOP 등과 같은 순수 자바 AOP 프레임워크는 **내부적으로 프록시를 사용**한다. 
스프링은 비즈니스 논리는 POJO로 구현하는데, 이 POJO는 순수하게 도메인에 초점을 맞춘다. 당연히 프레임워크에 의존하지도 않는다.
그래서 테스트가 쉽고 간단하다.

프로그래머는 설정 파일이나 API를 사용해 필수적인 애플리케이션 기반 구조를 구현한다. 여기에는 **영속성, 트랜잭션, 보안, 캐시, 장애조치 등과 같은 횡단 관심사(Cross-cutting concern)도 포함**된다.

### (3) AspectJ 관점

마지막으로 관심사를 관점으로 분리하는 가장 강력한 도구는 AspectJ 언어이다. 이는 언어 차원에서 관점을 모듈화 구성으로 지원하는 자바 언어 확장이다. 

다만 사용법을 익혀야 하고, 스프링 AOP가 관점이 필요한 상황의 80~90%는 충당하기 때문에 상황에 맞게 사용하는게 좋다.

### 테스트 주도 시스템 아키텍처 구축

건물은 일단 짓기 시작하면 극적인 변경이 불가능하다. <br/>
그러나 소프트웨어는 관점을 효과적으로 분리한다면 극적인 변화가 가능하다. <u>즉, 아주 단순하면서도 잘 분리된 아키텍처로 결과물을 빨리 출시한 후, 기반 구조를 추가하며 조금씩 확장해 나가는 것도 괜찮다</u>는 것이다.

반례로 초창기 EJB 아키텍처를 보면 기술을 너무 많이 넣는 바람에 관심사를 제대로 분리하지 못한 유명한 API 중 하나이다. 
**API는 설계가 아무리 좋아도 과유불급이다. 좋은 API는 걸리적거리지 않아야 한다!**

### 결론
POJO를 작성하고 관점 혹은 관점과 유사한 메커니즘을 사용해 각 구현 관심사를 분리해야 한다.
그래야 clean한 system을 구성할 수 있으며, 이는 TDD의 장점을 극대화할 수 있다.